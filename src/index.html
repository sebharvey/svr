<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Severn Valley Live Train Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background-color: #1a1a1a;
        color: #e0e0e0;
        padding: 20px;
        min-height: 100vh;
    }
    
    h1 {
        text-align: center;
        margin-bottom: 20px;
        font-size: 24px;
        color: #ffffff;
    }
    
    .controls {
        background-color: #2a2a2a;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .time-input-group {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .time-display {
        background-color: #3a3a3a;
        color: #e0e0e0;
        border: 1px solid #4a4a4a;
        padding: 6px 15px;
        border-radius: 4px;
        font-size: 16px;
        font-weight: bold;
        min-width: 80px;
        text-align: center;
    }
    
    .time-btn {
        background-color: #4a4a4a;
        color: #e0e0e0;
        border: 1px solid #5a5a5a;
        padding: 6px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 18px;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    
    .time-btn:hover {
        background-color: #5a5a5a;
    }
    
    .time-btn:active {
        background-color: #3a3a3a;
    }
    
    .live-btn {
        background-color: #4a4a4a;
        color: #e0e0e0;
        border: 1px solid #5a5a5a;
        padding: 8px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    
    .live-btn:hover:not(:disabled) {
        background-color: #5a5a5a;
    }
    
    .live-btn:disabled {
        background-color: #2a2a2a;
        border-color: #3a3a3a;
        color: #666;
        cursor: not-allowed;
    }
    
    .tracker-container {
        background-color: #2a2a2a;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .station {
        background-color: #404040;
        padding: 15px;
        border-radius: 6px;
        margin-bottom: 2px;
        position: relative;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .station-name {
        font-weight: bold;
        font-size: 16px;
        z-index: 1;
    }
    
    .track-section {
        background-color: #333333;
        position: relative;
        min-height: 100px;
        margin-bottom: 2px;
        display: flex;
        align-items: center;
    }
    
    .track-line {
        position: absolute;
        left: 50%;
        top: 0;
        bottom: 0;
        width: 3px;
        background-color: #555555;
        transform: translateX(-50%);
    }
    
    .train {
        position: absolute;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 13px;
        padding: 4px 8px;
        border-radius: 4px;
        white-space: nowrap;
        z-index: 2;
    }
    
    .train.northbound {
        left: 10%;
        flex-direction: row;
    }
    
    .train.southbound {
        right: 10%;
        flex-direction: row-reverse;
    }
    
    .train-icon {
        font-size: 20px;
    }
    
    .train-label {
        display: flex;
        flex-direction: column;
        font-size: 11px;
    }
    
    .train-number {
        font-weight: bold;
    }
    
    .direction-arrow {
        font-size: 14px;
    }
    
    .status-panel {
        background-color: #2a2a2a;
        border-radius: 8px;
        padding: 20px;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .status-panel h2 {
        font-size: 18px;
        margin-bottom: 15px;
        color: #ffffff;
    }
    
    .train-status {
        background-color: #333333;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 10px;
        border-left: 4px solid;
    }
    
    .train-status-header {
        font-weight: bold;
        margin-bottom: 6px;
        font-size: 14px;
    }
    
    .train-status-detail {
        font-size: 13px;
        color: #b0b0b0;
    }
    
    @media (max-width: 600px) {
        body {
            padding: 10px;
        }
        
        h1 {
            font-size: 20px;
        }
        
        .controls {
            flex-direction: column;
            align-items: stretch;
        }
        
        .controls label {
            justify-content: space-between;
        }
        
        .train {
            font-size: 11px;
        }
        
        .train-icon {
            font-size: 16px;
        }
    }
</style>

</head>
<body>
    <h1>Severn Valley Live Train Tracker</h1>

<div class="controls">
    <div class="time-input-group">
        <button class="time-btn" id="timeDown">â—€</button>
        <div class="time-display" id="timeDisplay">08:00</div>
        <button class="time-btn" id="timeUp">â–¶</button>
    </div>
    <button class="live-btn" id="liveBtn" disabled>Live Time</button>
</div>

<div class="tracker-container" id="trackerContainer"></div>

<div class="status-panel">
    <h2>Train Status</h2>
    <div id="statusContainer"></div>
</div>

<script>
    const timetableData = {

â€œrouteâ€: â€œKidderminster - Bridgnorthâ€,
â€œdateâ€: â€œSaturday 11 October onlyâ€,
â€œtrainsâ€: [
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ09:40â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œtimeâ€: â€œ09:58â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHighleyâ€, â€œtimeâ€: â€œ10:08â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ10:20â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ10:24â€, â€œdepartureâ€: â€œ10:27â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ10:40â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel DMUâ€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ10:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ11:07â€, â€œdepartureâ€: â€œ11:10â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ11:17â€, â€œdepartureâ€: â€œ11:20â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ11:29â€, â€œdepartureâ€: â€œ11:32â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ11:44â€, â€œdepartureâ€: â€œ11:47â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ12:00â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œSteam 75069â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ12:20â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ12:35â€, â€œdepartureâ€: â€œ12:38â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ12:45â€, â€œdepartureâ€: â€œ12:48â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ12:59â€, â€œdepartureâ€: â€œ13:02â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ13:14â€, â€œdepartureâ€: â€œ13:17â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ13:30â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ13:00â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ13:22â€, â€œdepartureâ€: â€œ13:25â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ13:32â€, â€œdepartureâ€: â€œ13:35â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ13:47â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œBewdleyâ€, â€œtimeâ€: â€œ14:00â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ14:57â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel DMUâ€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ13:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ14:02â€, â€œdepartureâ€: â€œ14:05â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ14:14â€, â€œdepartureâ€: â€œ14:17â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ14:27â€, â€œdepartureâ€: â€œ14:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ14:42â€, â€œdepartureâ€: â€œ14:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ14:57â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ14:40â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ14:55â€, â€œdepartureâ€: â€œ14:58â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ15:07â€, â€œdepartureâ€: â€œ15:10â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ15:17â€, â€œdepartureâ€: â€œ15:20â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ15:32â€, â€œdepartureâ€: â€œ15:35â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ15:55â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œSteam 75069â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ15:50â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ16:05â€, â€œdepartureâ€: â€œ16:08â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ16:15â€, â€œdepartureâ€: â€œ16:18â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ16:29â€, â€œdepartureâ€: â€œ16:32â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ16:44â€, â€œdepartureâ€: â€œ16:47â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ17:02â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œnorthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œBridgnorthâ€, â€œdepartureâ€: â€œ18:00â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œtimeâ€: â€œ18:18â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHighleyâ€, â€œtimeâ€: â€œ18:28â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ18:40â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ18:42â€, â€œdepartureâ€: â€œ18:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œKidderminsterâ€, â€œarrivalâ€: â€œ18:57â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ08:15â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ08:27â€, â€œdepartureâ€: â€œ08:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ08:45â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHighleyâ€, â€œtimeâ€: â€œ08:57â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œtimeâ€: â€œ09:05â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ09:13â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œSteam 75069â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ10:15â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ10:27â€, â€œdepartureâ€: â€œ10:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ10:42â€, â€œdepartureâ€: â€œ10:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ10:54â€, â€œdepartureâ€: â€œ10:57â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ11:07â€, â€œdepartureâ€: â€œ11:10â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ11:25â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ11:00â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ11:12â€, â€œdepartureâ€: â€œ11:15â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ11:30â€, â€œdepartureâ€: â€œ11:33â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ11:42â€, â€œdepartureâ€: â€œ11:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ11:55â€, â€œdepartureâ€: â€œ11:58â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ12:13â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel DMUâ€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ12:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ12:42â€, â€œdepartureâ€: â€œ12:45â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ13:00â€, â€œdepartureâ€: â€œ13:03â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ13:11â€, â€œdepartureâ€: â€œ13:14â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ13:22â€, â€œdepartureâ€: â€œ13:25â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ13:40â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ13:52â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œtimeâ€: â€œ14:05â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ14:20â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ13:49â€, â€œdepartureâ€: â€œ13:52â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ14:02â€, â€œdepartureâ€: â€œ14:05â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ14:20â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œSteam 75069â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ14:00â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ14:12â€, â€œdepartureâ€: â€œ14:15â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ14:27â€, â€œdepartureâ€: â€œ14:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ14:39â€, â€œdepartureâ€: â€œ14:42â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ14:55â€, â€œdepartureâ€: â€œ14:58â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ15:13â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel DMUâ€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ15:50â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ16:07â€, â€œdepartureâ€: â€œ16:10â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œarrivalâ€: â€œ16:30â€, â€œdepartureâ€: â€œ16:33â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHighleyâ€, â€œarrivalâ€: â€œ16:41â€, â€œdepartureâ€: â€œ16:44â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œarrivalâ€: â€œ16:52â€, â€œdepartureâ€: â€œ16:55â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ17:10â€, â€œstopsAtâ€: true }
]
},
{
â€œtrainNumberâ€: â€œDiesel 37248â€,
â€œdirectionâ€: â€œsouthboundâ€,
â€œstopsâ€: [
{ â€œstationâ€: â€œKidderminsterâ€, â€œdepartureâ€: â€œ16:30â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œBewdleyâ€, â€œarrivalâ€: â€œ16:44â€, â€œdepartureâ€: â€œ16:47â€, â€œstopsAtâ€: true },
{ â€œstationâ€: â€œArleyâ€, â€œtimeâ€: â€œ17:02â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHighleyâ€, â€œtimeâ€: â€œ17:14â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œHampton Loadeâ€, â€œtimeâ€: â€œ17:22â€, â€œstopsAtâ€: false },
{ â€œstationâ€: â€œBridgnorthâ€, â€œarrivalâ€: â€œ17:30â€, â€œstopsAtâ€: true }
]
}
]
};

    // Extract stations in order from Kidderminster to Bridgnorth
    const stations = ['Kidderminster', 'Bewdley', 'Arley', 'Highley', 'Hampton Loade', 'Bridgnorth'];
    
    // Assign unique colors to each unique train number dynamically from timetable
    const trainColors = {};
    const colorPalette = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#fd79a8', '#fdcb6e', '#6c5ce7', '#a29bfe', '#74b9ff'];
    
    // Extract unique train numbers from timetable and sort alphabetically
    const uniqueTrains = [...new Set(timetableData.trains.map(t => t.trainNumber))].sort();
    
    // Assign colors based on alphabetical order
    uniqueTrains.forEach((trainNumber, index) => {
        trainColors[trainNumber] = colorPalette[index % colorPalette.length];
    });
    
    function getTrainColor(trainNumber) {
        return trainColors[trainNumber] || '#888888';
    }
    
    function parseTime(timeStr) {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    }
    
    function formatTime(minutes) {
        const h = Math.floor(minutes / 60);
        const m = minutes % 60;
        return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}`;
    }
    
    function getTrainIcon(trainNumber) {
        if (trainNumber.includes('Steam')) return 'ðŸš‚';
        if (trainNumber.includes('DMU')) return 'ðŸšƒ';
        return 'ðŸš†';
    }
    
    // Manual time state - initialize to current time
    const now = new Date();
    let manualTime = now.getHours() * 60 + now.getMinutes();
    let isLiveMode = true;
    
    function updateTimeDisplay() {
        if (isLiveMode) {
            const now = new Date();
            const currentTime = now.getHours() * 60 + now.getMinutes();
            document.getElementById('timeDisplay').textContent = formatTime(currentTime);
        } else {
            document.getElementById('timeDisplay').textContent = formatTime(manualTime);
        }
    }
    
    function updateLiveButton() {
        const btn = document.getElementById('liveBtn');
        btn.disabled = isLiveMode;
    }
    
    function getCurrentTime() {
        if (isLiveMode) {
            const now = new Date();
            return now.getHours() * 60 + now.getMinutes();
        } else {
            return manualTime;
        }
    }
    
    function getStopTime(stop) {
        return parseTime(stop.departure || stop.arrival || stop.time);
    }
    
    function findTrainPosition(train, currentTime) {
        const stops = train.stops;
        
        // Check if train hasn't started yet
        const firstStop = stops[0];
        const startTime = getStopTime(firstStop);
        if (currentTime < startTime) {
            return null;
        }
        
        // Check if train has completed journey
        const lastStop = stops[stops.length - 1];
        const endTime = getStopTime(lastStop);
        
        // If train has finished this service
        if (currentTime > endTime) {
            // Check if there's a future service for this train
            const lastStation = lastStop.station;
            const nextService = getNextService(train.trainNumber, lastStation, currentTime);
            
            if (nextService) {
                // Train is waiting at terminus for next service
                return {
                    type: 'at_station',
                    station: lastStation
                };
            } else {
                // No future service - remove after 15 minutes
                if (currentTime > endTime + 15) {
                    return null;
                }
                return {
                    type: 'at_station',
                    station: lastStation
                };
            }
        }
        
        // Find current segment
        for (let i = 0; i < stops.length - 1; i++) {
            const currentStop = stops[i];
            const nextStop = stops[i + 1];
            
            const departTime = currentStop.departure ? parseTime(currentStop.departure) : getStopTime(currentStop);
            const arriveTime = nextStop.arrival ? parseTime(nextStop.arrival) : getStopTime(nextStop);
            
            if (currentTime >= departTime && currentTime <= arriveTime) {
                // Train is between stations
                const progress = (currentTime - departTime) / (arriveTime - departTime);
                return {
                    type: 'between',
                    fromStation: currentStop.station,
                    toStation: nextStop.station,
                    progress: progress,
                    departTime: departTime,
                    arriveTime: arriveTime
                };
            }
            
            // Check if at a station (between arrival and departure)
            if (currentStop.arrival && currentStop.departure) {
                const arrivalTime = parseTime(currentStop.arrival);
                const departureTime = parseTime(currentStop.departure);
                if (currentTime >= arrivalTime && currentTime < departureTime) {
                    return {
                        type: 'at_station',
                        station: currentStop.station
                    };
                }
            }
        }
        
        // Should not reach here, but return at final station as fallback
        return {
            type: 'at_station',
            station: lastStop.station
        };
    }
    
    function getNextService(trainNumber, currentStation, currentTime) {
        // Find any service with the same train number that departs from the current station
        const services = timetableData.trains.filter(t => t.trainNumber === trainNumber);
        
        for (let service of services) {
            const firstStop = service.stops[0];
            const startTime = getStopTime(firstStop);
            // Check that the service starts from the current station and is in the future
            if (startTime > currentTime && firstStop.station === currentStation) {
                return {
                    service: service,
                    departTime: startTime
                };
            }
        }
        return null;
    }
    
    function generateStatusText(train, position, currentTime) {
        const stops = train.stops;
        
        if (!position) {
            return null;
        }
        
        if (position.type === 'at_station') {
            const isTerminus = position.station === 'Kidderminster' || position.station === 'Bridgnorth';
            
            if (isTerminus) {
                const nextService = getNextService(train.trainNumber, position.station, currentTime);
                if (nextService) {
                    const minutesUntil = nextService.departTime - currentTime;
                    return `Waiting at ${position.station}, next departure at ${formatTime(nextService.departTime)} (departing in ${minutesUntil} minute${minutesUntil !== 1 ? 's' : ''})`;
                } else {
                    return `Terminated at ${position.station}`;
                }
            }
            
            // At intermediate station
            const currentStopIndex = stops.findIndex(s => s.station === position.station);
            const currentStop = stops[currentStopIndex];
            if (currentStop.departure) {
                const nextStop = stops[currentStopIndex + 1];
                const departTime = parseTime(currentStop.departure);
                const minutesUntil = departTime - currentTime;
                return `At ${position.station}, departing at ${currentStop.departure} (in ${minutesUntil} minute${minutesUntil !== 1 ? 's' : ''}) â†’ ${nextStop.station}`;
            }
        }
        
        if (position.type === 'between') {
            const minutesUntilArrival = position.arriveTime - currentTime;
            const arrivalText = minutesUntilArrival === 0 ? 'arriving now' : `arriving ${formatTime(position.arriveTime)} in ${minutesUntilArrival} minute${minutesUntilArrival !== 1 ? 's' : ''}`;
            
            // Check for non-stop stations
            let statusParts = [`Traveling from ${position.fromStation} (departed ${formatTime(position.departTime)}) â†’ ${position.toStation} (${arrivalText})`];
            
            // Find stations being passed without stopping
            const fromIndex = stations.indexOf(position.fromStation);
            const toIndex = stations.indexOf(position.toStation);
            const intermediateStations = train.direction === 'northbound' 
                ? stations.slice(fromIndex + 1, toIndex)
                : stations.slice(toIndex + 1, fromIndex);
            
            for (let station of intermediateStations) {
                const stopInfo = stops.find(s => s.station === station);
                if (stopInfo && !stopInfo.stopsAt) {
                    const passTime = getStopTime(stopInfo);
                    const minutesUntilPass = passTime - currentTime;
                    if (minutesUntilPass > 0) {
                        statusParts.push(`Passing ${station} in ${minutesUntilPass} minute${minutesUntilPass !== 1 ? 's' : ''}`);
                    }
                }
            }
            
            return statusParts.join(' â€¢ ');
        }
        
        return null;
    }
    
    function renderTracker() {
        const container = document.getElementById('trackerContainer');
        const currentTime = getCurrentTime();
        container.innerHTML = '';
        
        // Track active trains by train number only (not direction)
        const activeTrains = {};
        
        for (let train of timetableData.trains) {
            const position = findTrainPosition(train, currentTime);
            if (position) {
                const key = train.trainNumber;
                
                // If this train number already exists, pick the most relevant service
                if (activeTrains[key]) {
                    const existingTrain = activeTrains[key].train;
                    const existingPosition = activeTrains[key].position;
                    
                    const currentStartTime = getStopTime(train.stops[0]);
                    const currentEndTime = getStopTime(train.stops[train.stops.length - 1]);
                    const existingStartTime = getStopTime(existingTrain.stops[0]);
                    const existingEndTime = getStopTime(existingTrain.stops[existingTrain.stops.length - 1]);
                    
                    // Prioritize services that are actually running right now
                    const currentIsRunning = currentTime >= currentStartTime && currentTime <= currentEndTime;
                    const existingIsRunning = currentTime >= existingStartTime && currentTime <= existingEndTime;
                    
                    if (currentIsRunning && !existingIsRunning) {
                        // Current service is running, existing is not - use current
                        activeTrains[key] = { train, position };
                    } else if (!currentIsRunning && existingIsRunning) {
                        // Keep existing as it's running
                        // Do nothing
                    } else if (currentIsRunning && existingIsRunning) {
                        // Both running - prioritize the one that's moving
                        if (position.type === 'between' && existingPosition.type === 'at_station') {
                            activeTrains[key] = { train, position };
                        }
                    } else {
                        // Neither running currently
                        // If both haven't started yet, pick the earlier one
                        // If one has finished and one hasn't started, keep the finished one (it's waiting)
                        const currentHasFinished = currentTime > currentEndTime;
                        const existingHasFinished = currentTime > existingEndTime;
                        
                        if (currentHasFinished && !existingHasFinished) {
                            // Current has finished, existing hasn't started - keep existing (waiting train)
                            // Actually no - keep current as it's the one that's there
                            activeTrains[key] = { train, position };
                        } else if (!currentHasFinished && existingHasFinished) {
                            // Existing has finished, current hasn't started - keep existing
                            // Do nothing
                        } else if (currentHasFinished && existingHasFinished) {
                            // Both have finished - keep most recent
                            if (currentEndTime > existingEndTime) {
                                activeTrains[key] = { train, position };
                            }
                        }
                    }
                } else {
                    activeTrains[key] = { train, position };
                }
            }
        }
        
        // For trains at terminus stations waiting for next service, show them on the departure side
        for (let key in activeTrains) {
            const { train, position } = activeTrains[key];
            if (position.type === 'at_station') {
                const isTerminus = position.station === 'Kidderminster' || position.station === 'Bridgnorth';
                if (isTerminus) {
                    // Only switch to next service if current service has finished
                    const currentEndTime = getStopTime(train.stops[train.stops.length - 1]);
                    if (currentTime > currentEndTime) {
                        const nextService = getNextService(train.trainNumber, position.station, currentTime);
                        if (nextService) {
                            // Update to show the train ready for its next departure direction
                            activeTrains[key] = {
                                train: nextService.service,
                                position: position
                            };
                        }
                    }
                }
            }
        }
        
        // Render stations and tracks
        for (let i = 0; i < stations.length; i++) {
            const station = stations[i];
            
            // Create station div
            const stationDiv = document.createElement('div');
            stationDiv.className = 'station';
            stationDiv.innerHTML = `<div class="station-name">${station}</div>`;
            
            // Add trains at this station
            for (let key in activeTrains) {
                const { train, position } = activeTrains[key];
                if (position.type === 'at_station' && position.station === station) {
                    const trainDiv = createTrainElement(train, 50);
                    stationDiv.appendChild(trainDiv);
                }
            }
            
            container.appendChild(stationDiv);
            
            // Create track section (except after last station)
            if (i < stations.length - 1) {
                const trackDiv = document.createElement('div');
                trackDiv.className = 'track-section';
                trackDiv.innerHTML = '<div class="track-line"></div>';
                
                const nextStation = stations[i + 1];
                
                // Add trains between stations
                for (let key in activeTrains) {
                    const { train, position } = activeTrains[key];
                    if (position.type === 'between') {
                        // For northbound: from is lower station, to is upper station
                        // For southbound: from is upper station, to is lower station
                        // Track sections go from current station to next (upward in list)
                        let matchesSegment = false;
                        
                        if (train.direction === 'northbound') {
                            // Northbound goes from Bridgnorth to Kidderminster (bottom to top)
                            matchesSegment = position.fromStation === nextStation && position.toStation === station;
                        } else {
                            // Southbound goes from Kidderminster to Bridgnorth (top to bottom)
                            matchesSegment = position.fromStation === station && position.toStation === nextStation;
                        }
                        
                        if (matchesSegment) {
                            // progress goes 0 to 1 from departure to arrival
                            // For northbound: start at bottom (100%) and move to top (0%)
                            // For southbound: start at top (0%) and move to bottom (100%)
                            const percentage = train.direction === 'northbound' 
                                ? (1 - position.progress) * 100 
                                : position.progress * 100;
                            const trainDiv = createTrainElement(train, percentage);
                            trackDiv.appendChild(trainDiv);
                        }
                    }
                }
                
                container.appendChild(trackDiv);
            }
        }
        
        // Render status panel
        renderStatus(activeTrains, currentTime);
    }
    
    function createTrainElement(train, topPercentage) {
        const trainDiv = document.createElement('div');
        trainDiv.className = `train ${train.direction}`;
        trainDiv.style.top = `${topPercentage}%`;
        trainDiv.style.transform = 'translateY(-50%)';
        
        const color = getTrainColor(train.trainNumber);
        trainDiv.style.backgroundColor = color + '33';
        trainDiv.style.borderLeft = `3px solid ${color}`;
        
        const icon = getTrainIcon(train.trainNumber);
        const arrow = train.direction === 'northbound' ? 'â†‘' : 'â†“';
        
        trainDiv.innerHTML = `
            <div class="train-label">
                <span class="train-number">${train.trainNumber}</span>
            </div>
            <span class="train-icon">${icon}</span>
            <span class="direction-arrow">${arrow}</span>
        `;
        
        return trainDiv;
    }
    
    function renderStatus(activeTrains, currentTime) {
        const container = document.getElementById('statusContainer');
        container.innerHTML = '';
        
        if (Object.keys(activeTrains).length === 0) {
            container.innerHTML = '<div style="color: #888;">No trains currently active</div>';
            return;
        }
        
        for (let key in activeTrains) {
            const { train, position } = activeTrains[key];
            const statusText = generateStatusText(train, position, currentTime);
            
            if (statusText) {
                const statusDiv = document.createElement('div');
                statusDiv.className = 'train-status';
                const color = getTrainColor(train.trainNumber);
                statusDiv.style.borderLeftColor = color;
                
                statusDiv.innerHTML = `
                    <div class="train-status-header">${train.trainNumber} (${train.direction})</div>
                    <div class="train-status-detail">${statusText}</div>
                `;
                
                container.appendChild(statusDiv);
            }
        }
    }
    
    // Event listeners
    document.getElementById('timeUp').addEventListener('click', () => {
        if (isLiveMode) {
            const now = new Date();
            manualTime = now.getHours() * 60 + now.getMinutes();
            isLiveMode = false;
        }
        manualTime += 5;
        if (manualTime >= 24 * 60) manualTime = 0;
        updateTimeDisplay();
        updateLiveButton();
        renderTracker();
        startAutoRefresh();
    });
    
    document.getElementById('timeDown').addEventListener('click', () => {
        if (isLiveMode) {
            const now = new Date();
            manualTime = now.getHours() * 60 + now.getMinutes();
            isLiveMode = false;
        }
        manualTime -= 5;
        if (manualTime < 0) manualTime = 24 * 60 - 5;
        updateTimeDisplay();
        updateLiveButton();
        renderTracker();
        startAutoRefresh();
    });
    
    document.getElementById('liveBtn').addEventListener('click', () => {
        isLiveMode = true;
        updateTimeDisplay();
        updateLiveButton();
        renderTracker();
        startAutoRefresh();
    });
    
    // Auto-refresh in live mode
    let refreshInterval;
    
    function startAutoRefresh() {
        if (refreshInterval) {
            clearInterval(refreshInterval);
            refreshInterval = null;
        }
        
        if (isLiveMode) {
            refreshInterval = setInterval(() => {
                updateTimeDisplay();
                renderTracker();
            }, 30000); // 30 seconds
        }
    }
    
    // Initial render
    updateTimeDisplay();
    updateLiveButton();
    renderTracker();
    startAutoRefresh();
</script>

</body>
</html>
